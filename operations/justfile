default:
    @echo "CineMatch Infrastructure"
    @echo ""
    @echo "Usage:"
    @echo "  just foundation/<cmd>    # Manage foundation layer (VPC, ECS Cluster, ECR)"
    @echo "  just service/<cmd>       # Manage service layer (ALB, ECS Services)"
    @echo "  just deploy <tag>        # Deploy new image tag to production"
    @echo "  just deploy-preview <tag> <name>  # Deploy to preview environment"
    @echo ""
    @echo "Examples:"
    @echo "  just foundation/plan     # Plan foundation changes"
    @echo "  just service/workspace preview-123  # Create/switch to preview workspace"
    @echo "  just service/deploy abc123  # Deploy image tag abc123"

# Foundation shortcuts
foundation/cmd:
    cd 00-foundation && just {{cmd}}

# Service shortcuts
service/cmd:
    cd 01-service && just {{cmd}}

# Deploy to production
deploy image_tag:
    cd 01-service && terraform workspace select production
    cd 01-service && terraform apply -var="image_tag={{image_tag}}"

# Deploy to preview environment
deploy-preview image_tag name:
    cd 01-service && terraform workspace select {{name}} || terraform workspace new {{name}}
    cd 01-service && terraform apply -var="image_tag={{image_tag}}"

# Destroy preview environment
destroy-preview name:
    cd 01-service && terraform workspace select {{name}}
    cd 01-service && terraform destroy
    cd 01-service && terraform workspace select production
    cd 01-service && terraform workspace delete {{name}}

# Initialize all
init:
    cd 00-foundation && terraform init
    cd 01-service && terraform init
